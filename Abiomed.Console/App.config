<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <configSections>
    <section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler,log4net" />
    <section name="ConnectionManager" type="System.Configuration.NameValueSectionHandler" />
    <section name="OptionsManager" type="System.Configuration.NameValueSectionHandler" />
  </configSections>
    
  <startup>
    <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.5.2" />
  </startup>
  <connectionStrings>
    <add name="MongoDbConnectionString" connectionString="mongodb://localhost/{DB_NAME}?safe=true" />
  </connectionStrings>  
  <runtime>  
       <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">  
            <dependentAssembly>  
                 <assemblyIdentity name="log4net" publicKeyToken="669e0ddf0bb1aa2a" culture="neutral" />  
                 <bindingRedirect oldVersion="0.0.0.0-1.2.15.0" newVersion="1.2.15.0" />  
            </dependentAssembly>  
            <dependentAssembly>  
                 <assemblyIdentity name="Autofac" publicKeyToken="17863af14b0044da" culture="neutral" />  
                 <bindingRedirect oldVersion="0.0.0.0-4.3.0.0" newVersion="4.3.0.0" />  
            </dependentAssembly>  
            <dependentAssembly>  
                 <assemblyIdentity name="System.Web.Http" publicKeyToken="31bf3856ad364e35" culture="neutral" />  
                 <bindingRedirect oldVersion="0.0.0.0-5.2.3.0" newVersion="5.2.3.0" />  
            </dependentAssembly>  
            <dependentAssembly>  
                 <assemblyIdentity name="System.Net.Http.Formatting" publicKeyToken="31bf3856ad364e35" culture="neutral" />  
                 <bindingRedirect oldVersion="0.0.0.0-5.2.3.0" newVersion="5.2.3.0" />  
            </dependentAssembly>  
            <dependentAssembly>  
                 <assemblyIdentity name="Newtonsoft.Json" publicKeyToken="30ad4fe6b2a6aeed" culture="neutral" />  
                 <bindingRedirect oldVersion="0.0.0.0-9.0.0.0" newVersion="9.0.0.0" />  
            </dependentAssembly>  
       </assemblyBinding>  
  </runtime>

  <log4net>
    <appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender">
      <file value="log.txt" />
      <appendToFile value="true" />
      <rollingStyle value="Size" />
      <maxSizeRollBackups value="10" />
      <maximumFileSize value="250KB" />
      <staticLogFileName value="true" />
      <layout type="log4net.Layout.PatternLayout">
        <conversionPattern value="%date [%thread] %-5level %logger [%property{NDC}] - %message%newline" />
      </layout>
    </appender>
    <appender name="MongoDBAppender" type="Log4Mongo.MongoDBAppender, Log4Mongo">
      <!-- 
    MongoDB database connection in the format:
    mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]
    See http://www.mongodb.org/display/DOCS/Connections for connectionstring options 
    If no database specified, default to "log4net"
    -->
      <connectionString value="mongodb://localhost" />
      <!-- 
    Name of connectionString defined in web/app.config connectionStrings group, the format is the same as connectionString value.
    Optional, If not provided will use connectionString value
    -->
      <connectionStringName value="mongo-log4net" />
      <!-- 
    The Friendly Name of the certificate. This value will be used if SSL is set to true
    The default StoreLocation is LocalMachine and StoreName is My
   
      <certificateFriendlyName value="Certificate Friendly Name" /> -->
      <!-- 
    If set, a TTL (Time To Live) index will be created on the Timestamp field.  
    Records older than this value will be deleted.
    -->
      <expireAfterSeconds value="10" />
      <!-- 
    Name of the collection in database
    Optional, Defaults to "logs"
    -->
      <collectionName value="logs" />

      <!--
    Maximum size of newly created collection. Optional, Defaults to creating uncapped collections
    -->
      <newCollectionMaxSize value="65536" />
      <newCollectionMaxDocs value="5000" />

      <field>
        <!-- Note: this needs to be "timestamp" and NOT "Timestamp"  for the TTL index to work -->
        <name value="timestamp" />
        <layout type="log4net.Layout.RawTimeStampLayout" />
      </field>
      <field>
        <name value="level" />
        <layout type="log4net.Layout.PatternLayout" value="%level" />
      </field>
      <field>
        <name value="thread" />
        <layout type="log4net.Layout.PatternLayout" value="%thread" />
      </field>
      <field>
        <name value="logger" />
        <layout type="log4net.Layout.PatternLayout" value="%logger" />
      </field>
      <field>
        <name value="message" />
        <layout type="log4net.Layout.PatternLayout" value="%message" />
      </field>
      <field>
        <name value="mycustomproperty" />
        <layout type="log4net.Layout.RawPropertyLayout">
          <key value="mycustomproperty" />
        </layout>
      </field>
    </appender>
    <appender name="ConsoleAppender" type="log4net.Appender.ConsoleAppender">
      <param name="Threshold" value="INFO" />
      <layout type="log4net.Layout.PatternLayout">
        <param name="ConversionPattern" value="%d [%t] %-5p %c [%x] - %m%n" />
      </layout>
    </appender>
    <root>
      <level value="INFO" />
      <appender-ref ref="RollingFileAppender" />
      <appender-ref ref="MongoDBAppender" />
      <appender-ref ref="ConsoleAppender" />
    </root>
  </log4net>
  <ConnectionManager>
    <add key="RUN" value="localhost" />
    <add key="WOWZA" value="10.11.0.16" />
    <add key="WEB" value="10.11.0.19" />
    <add key="RLR" value="10.11.0.12" />
  </ConnectionManager>
  <OptionsManager>
    <add key="KeepAliveTimer" value="5000" />
  </OptionsManager>
</configuration>